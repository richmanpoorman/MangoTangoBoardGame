using System;
using Godot;

public class GameSaver : FileSaver {
    public void SaveGame(Board board) {
    #nullable enable
		String gameNumber;
		if (!FileAccess.FileExists("user://SaveMetaData.step")) {
			FileAccess metaFile = FileAccess.Open("user://SaveMetaData.step", FileAccess.ModeFlags.Write);
			gameNumber = "0";
			metaFile.StoreLine(gameNumber);
		} else {
			FileAccess metaFile = FileAccess.Open("user://SaveMetaData.step", FileAccess.ModeFlags.Write);
			gameNumber = metaFile.GetLine() ;
		}
		FileAccess gameFile = FileAccess.Open("user://Game" + gameNumber + ".step", FileAccess.ModeFlags.Write);
		int[] size = board.size();
		for (int i = 0; i < size[0]; i++) for (int j = 0; j < size[1]; j++) {
			String? entry = null;
			Tile? currTile = board.tileAt(new Position(i ,j)); 
			if (currTile != null) {
				char color = (currTile == Color.PLAYER_1) ? 'r' : 'b';
				entry = "" + ('a' + i) + j + '=' + color + 't';
				Scout? currScout = board.scoutAt(new Position(i,j));
				if(currScout != null) {
					entry += 's';
				}
			}
			if (entry != null) {
				gameFile.StoreLine(entry);
			}
			

		}
		#nullable disable
    }
    public void LoadGame() {}
}